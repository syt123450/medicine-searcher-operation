<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script src="js/jquery.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="css/index.css">
</head>
<body>

<div class="container">
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand">Medicine</a>
            </div>
            <div>
                <ul class="nav navbar-nav">
                    <li class="active"><a>Buy</a></li>
                    <li><a href="html/management.html">Management</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div href="#" class="list-group-item">
        <div class="row">
            <div class="col-sm-3"><h4>Search Medicine :</h4></div>
            <div class="col-sm-2">
                <input id="customerName" type="text" class="form-control" placeholder="User Name">
            </div>
            <div class="col-sm-2">
                <input id="medicineName" type="text" class="form-control" placeholder="Medicine Name">
            </div>
            <div class="col-sm-4">
                <button id="search" class="btn btn-default" type="button">Search</button>
            </div>
        </div>
    </div>

    <table class="table table-hover">
        <caption>Available Medicine</caption>
        <thead>
        <tr>
            <th>Factory</th>
            <th>Brand</th>
            <th>Medicine</th>
            <th>Store</th>
            <th>Price</th>
            <th>Number</th>
            <th>Purchase</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td data-factoryId="factoryId">factoryName</td>
            <td data-brandId="brandId">brandName</td>
            <td data-medicineId="medicineId">medicineName</td>
            <td data-storeId="storeId">storeName</td>
            <td>12</td>
            <td>

                <div class="input-group" class="col-lg-6">
                    <span class="input-group-btn">
						<button class="btn btn-default" type="button">-</button>
					</span>
                    <input type="text" class="form-control" value="1">
                    <span class="input-group-btn">
						<button class="btn btn-default" type="button">+</button>
					</span>
                </div>

            </td>
            <td>
                <button type="button" class="btn btn-primary btn-sm">Buy</button>
            </td>
        </tr>

        </tbody>
    </table>

</div>

<footer>
    Copyright Â© 2017 CMPE272 Team Ultimate All Rights Reserved.
</footer>

<script>

    $(function(){
        $(".input-group button").click(function() {
            if ($(this).text() === "-") {

                var input = $(this).parent().parent().find("input");
                if ($(input).val() > 0) {
                    $(input).val(parseInt($(input).val()) - 1);
                }
            }
            else {
                var input = $(this).parent().parent().find("input");
                $(input).val(parseInt($(input).val()) + 1);
            }
        });

        $("table button").click(function() {
            var line = $(this).parent().parent();
            var factoryId = $(line).find("td:eq(0)").attr("data-factoryId");
            var brandId = $(line).find("td:eq(1)").attr("data-brandId");
            var medicineId = $(line).find("td:eq(2)").attr("data-medicineId");
            var storeId = $(line).find("td:eq(3)").attr("data-storeId");
            var price = parseInt($(line).find("td:eq(4)").text());
            var quantity = parseInt($(line).find("input").val());
            var customerName = $("#customerName").val();

            var postBody = {
                "factoryId": factoryId,
                "brandId": brandId,
                "medicineId": medicineId,
                "storeId": storeId,
                "price": price,
                "quantity": quantity,
                "customerName": customerName
            };

            console.log(postBody);

            $.ajax({
                url: 'api/insertSaleTransaction.php',
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                async: true,
                data: JSON.stringify(postBody),
                dataType: 'json',
                error: function(data) {
                    console.log(data);
                }
            });
        });

        $("#search").click(function() {
            var medicineKeyword = $("#medicineName").val();
            var customerName = $("#customerName").val();

            var postBody = {
                "medicineKeyword": medicineKeyword,
                "customerName": customerName
            };

            console.log(postBody);

            $.ajax({
                url: 'api/getMedicine.php',
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                async: true,
                data: JSON.stringify(postBody),
                dataType: 'json',
                success: function(data) {
                    console.log(data);
                },
                error: function(data) {
                    console.log(data);
                }
            });
        });
    });

    function renderSearchResult() {

    }

</script>

</body>
</html>